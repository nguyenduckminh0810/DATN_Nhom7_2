<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test B·ªô L·ªçc S·∫£n Ph·∫©m</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .product-card {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .product-card img {
        width: 100px;
        height: 100px;
        object-fit: cover;
      }
      .filter-controls {
        margin: 20px 0;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
      }
      .filter-group {
        margin: 10px 0;
      }
      label {
        margin-right: 10px;
      }
      .stock-info {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 4px;
      }
      .in-stock {
        background-color: #d4edda;
        color: #155724;
      }
      .out-of-stock {
        background-color: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>Test B·ªô L·ªçc S·∫£n Ph·∫©m</h1>

    <div class="filter-controls">
      <div class="filter-group">
        <label><strong>T√¨nh tr·∫°ng:</strong></label>
        <label
          ><input type="radio" name="availability" value="all" checked /> T·∫•t
          c·∫£</label
        >
        <label
          ><input type="radio" name="availability" value="inStock" /> C√≤n
          h√†ng</label
        >
        <label
          ><input type="radio" name="availability" value="outOfStock" /> H·∫øt
          h√†ng</label
        >
      </div>
      <button onclick="loadProducts()">T·∫£i s·∫£n ph·∫©m</button>
      <button onclick="applyFilter()">√Åp d·ª•ng b·ªô l·ªçc</button>
    </div>

    <div id="result"></div>

    <script>
      let allProducts = [];

      async function loadProducts() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "ƒêang t·∫£i s·∫£n ph·∫©m...";

        try {
          const response = await fetch(
            "http://localhost:8080/api/san-pham?size=20"
          );
          const data = await response.json();

          if (data && data.content) {
            allProducts = data.content;
            displayProducts(allProducts);
          } else {
            resultDiv.innerHTML = "Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o";
          }
        } catch (error) {
          console.error("Error:", error);
          resultDiv.innerHTML = `L·ªói: ${error.message}`;
        }
      }

      function applyFilter() {
        const availability = document.querySelector(
          'input[name="availability"]:checked'
        ).value;

        console.log("üîç Applying filter:", availability);

        let filteredProducts = allProducts;

        if (availability !== "all") {
          filteredProducts = allProducts.filter((product) => {
            const stockValue =
              product.tonKho !== undefined ? product.tonKho : 0;
            const inStock = stockValue > 0;

            // Debug cho √°o kho√°c
            if (product.ten && product.ten.includes("kho√°c")) {
              console.log(`üß• √Åo kho√°c "${product.ten}":`, {
                tonKho: product.tonKho,
                inStock,
                filter: availability,
                willShow:
                  (availability === "inStock" && inStock) ||
                  (availability === "outOfStock" && !inStock),
              });
            }

            if (availability === "inStock") {
              return inStock;
            }
            if (availability === "outOfStock") {
              return !inStock;
            }
            return true;
          });
        }

        console.log(
          `üìä Filtered ${filteredProducts.length} products from ${allProducts.length}`
        );
        displayProducts(filteredProducts);
      }

      function displayProducts(products) {
        const resultDiv = document.getElementById("result");

        if (products.length === 0) {
          resultDiv.innerHTML =
            "<p>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc</p>";
          return;
        }

        let html = `<h3>Hi·ªÉn th·ªã ${products.length} s·∫£n ph·∫©m:</h3>`;

        products.forEach((product) => {
          const imageUrl = product.anhDaiDien
            ? `http://localhost:8080${product.anhDaiDien}`
            : "https://via.placeholder.com/100x100?text=No+Image";
          const stockValue = product.tonKho !== undefined ? product.tonKho : 0;
          const inStock = stockValue > 0;
          const stockClass = inStock ? "in-stock" : "out-of-stock";
          const stockText = inStock ? `C√≤n ${stockValue} s·∫£n ph·∫©m` : "H·∫øt h√†ng";

          html += `
                    <div class="product-card">
                        <img src="${imageUrl}" alt="${
            product.ten
          }" onerror="this.src='https://via.placeholder.com/100x100?text=Error'" />
                        <div>
                            <h4>${product.ten}</h4>
                            <p>Gi√°: ${product.gia?.toLocaleString()}ƒë</p>
                            <p>Danh m·ª•c: ${product.danhMucTen}</p>
                            <div class="stock-info ${stockClass}">
                                ${stockText}
                            </div>
                            <small>ID: ${product.id} | Slug: ${
            product.slug
          }</small>
                        </div>
                    </div>
                `;
        });

        resultDiv.innerHTML = html;
      }

      // Load products on page load
      window.onload = loadProducts;
    </script>
  </body>
</html>
